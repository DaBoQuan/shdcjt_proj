alter table CptCapital add StockInDate char(10)
GO


ALTER    PROCEDURE CptCapital_Duplicate (
@capitalid 	int,
@customerid	int,
@price		decimal,
@capitalspec	varchar(60),
@location	varchar(100),
@invoice	varchar(80),
@StockInDate	char(10),
@flag integer output,
@msg varchar(80) output)
AS 
declare @maxid int

INSERT INTO [CptCapital] 
(mark,
name,
barcode,
startdate,
enddate,
seclevel,
departmentid,
costcenterid,
resourceid,
crmid,
sptcount,
currencyid ,
capitalcost,
startprice,
depreendprice,
capitalspec,
capitallevel,
manufacturer,
manudate,
capitaltypeid,
capitalgroupid,
unitid,
capitalnum,
currentnum,
replacecapitalid,
version,
itemid,
remark,
capitalimageid,
depremethod1,
depremethod2,
deprestartdate,
depreenddate,
customerid,
attribute,
stateid,
location,
usedhours,
datefield1,
datefield2,
datefield3,
datefield4,
datefield5,
numberfield1,
numberfield2,
numberfield3,
numberfield4,
numberfield5,
textfield1,
textfield2,
textfield3,
textfield4,
textfield5,
tinyintfield1,
tinyintfield2,
tinyintfield3,
tinyintfield4,
tinyintfield5,
createrid,
createdate,
createtime,
lastmoderid,
lastmoddate,
lastmodtime,
isdata,
datatype,
relatewfid,
invoice,
StockInDate)

select 
mark,
name,
barcode,
startdate,
enddate	,
seclevel,
departmentid,
costcenterid,
resourceid,
crmid,
sptcount,
currencyid ,
capitalcost,
@price,
depreendprice,
@capitalspec,
capitallevel,
manufacturer,
manudate,
capitaltypeid,
capitalgroupid,
unitid,
capitalnum,
currentnum,
replacecapitalid,
version,
itemid,
remark,
capitalimageid,
depremethod1,
depremethod2,
deprestartdate,
depreenddate,
@customerid,
attribute,
stateid,
@location,
usedhours,
datefield1,
datefield2,
datefield3,
datefield4,
datefield5,
numberfield1,
numberfield2,
numberfield3,
numberfield4,
numberfield5,
textfield1,
textfield2,
textfield3,
textfield4,
textfield5,
tinyintfield1,
tinyintfield2,
tinyintfield3,
tinyintfield4,
tinyintfield5,
createrid,
createdate,
createtime,
lastmoderid,
lastmoddate,
lastmodtime,
isdata,
datatype,
relatewfid,
@invoice,
@StockInDate 
from CptCapital
where id = @capitalid

select @maxid = max(id)  from CptCapital
update CptCapital set capitalnum = 0 where id = @maxid
select @maxid



GO



ALTER   PROCEDURE CptCapital_UpdatePrice(
@id 		int, 
@price 		decimal(18,3), 
@capitalspec	varchar(60),
@customerid	int,
@location	varchar(100),
@invoice	varchar(80)  ,
@StockInDate	char(10),
@flag	int	output, 
@msg	varchar(80)	output) AS 

UPDATE CptCapital 
SET  startprice=@price ,
capitalspec=@capitalspec , 
customerid=@customerid , 
location=@location ,
invoice=@invoice,
StockInDate=@StockInDate 
WHERE ( id = @id) 

set @flag = 1 
set @msg = 'OK!'

GO
