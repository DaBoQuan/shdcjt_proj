ALTER PROCEDURE CptBorrowBuffer_Check ( @currDate char(10), @flag integer output , @msg varchar(80) output) AS DECLARE @m_recId int DECLARE @m_cptId int DECLARE @m_useDate char(10) DECLARE @m_deptId int DECLARE @m_userId int DECLARE @m_depositary varchar(200) DECLARE @m_remark varchar(4000) DECLARE all_cursor CURSOR FOR SELECT id, cptId, useDate, deptId, userId, depositary, remark FROM CptBorrowBuffer OPEN all_cursor FETCH NEXT FROM all_cursor INTO @m_recId, @m_cptId, @m_useDate, @m_deptId, @m_userId, @m_depositary, @m_remark WHILE (@@FETCH_STATUS = 0) BEGIN IF (@currDate >= @m_useDate) BEGIN EXEC CptUseLogLend_Insert @m_cptId, @m_useDate, @m_deptId, @m_userId, 1, @m_depositary, 0, '', 0, '3', @m_remark, 0, '', '' DELETE CptBorrowBuffer WHERE id = @m_recId END  FETCH NEXT FROM all_cursor INTO @m_recId, @m_cptId, @m_useDate, @m_deptId, @m_userId, @m_depositary, @m_remark END CLOSE all_cursor DEALLOCATE all_cursor
GO
