ALTER PROCEDURE CptUseLogDiscard_Insert (@capitalid_1 	[int], @usedate_2 	[char](10), @usedeptid_3 	[int], @useresourceid_4 	[int], @usecount_5 	[decimal](18,3), @useaddress_6 	[varchar](200), @userequest_7 	[int], @maintaincompany_8 	[varchar](100), @fee_9 	[decimal](18,3), @usestatus_10 	varchar(2), @remark_11 	[text], @sptcount_12	[char](1), @flag integer output, @msg varchar(80) output)  AS declare @num [decimal](18,3) /*判断数量是否足够(对于非单独核算的资产*/ if @sptcount_12<>'1' begin select @num=capitalnum  from CptCapital where id = @capitalid_1 if @num<@usecount_5 begin select -1 return end else begin select @num = @num-@usecount_5 end end INSERT INTO [CptUseLog] ( [capitalid], [usedate], [usedeptid], [useresourceid], [usecount], [useaddress], [userequest], [maintaincompany], [fee], [usestatus], [remark])  VALUES ( @capitalid_1, @usedate_2, @usedeptid_3, @useresourceid_4, @usecount_5, @useaddress_6, @userequest_7, @maintaincompany_8, @fee_9, '5', @remark_11) /*单独核算的资产*/ if @sptcount_12 ='1' begin Update CptCapital Set departmentid = null, costcenterid = null, resourceid   = null, location	     =  null, stateid = @usestatus_10 where id = @capitalid_1 end /*非单独核算的资产*/ else begin Update CptCapital Set capitalnum = @num where id = @capitalid_1 end  select 1

GO
